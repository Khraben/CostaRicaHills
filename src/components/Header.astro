---
import '../styles/Header.css';
import {listenForAuthChanges,userName, userPhotoUrl } from './auth';
import '../styles/Header.css';
listenForAuthChanges();
---
<header class="navbar">
  <nav>
    <div class="logo-container">
      <img src="src/assets/Logo Costa Rica Hills sin fondo.png" alt="Logo" />
      <span>Costa Rica Hills</span>
    </div>
    <div class="nav-links">
      <a href="/tours">Tours</a>
      <a href="/about">Sobre Nosotros</a>
      <!-- Foto del usuario -->
      <img src={userPhotoUrl} alt="Foto de Usuario" class="user-photo" id="user-photo"/>
    </div>
  </nav>
  
  <!-- Modal de inicio de sesión -->
  <div id="login-modal" class="modal" style="display: none;">
      <div class="modal-content" onclick="event.stopPropagation();">
          <span class="close" onclick="document.getElementById('login-modal').style.display='none'">&times;</span>
          <h2 id="modal-title">Iniciar Sesión</h2>    
          <!-- Información del usuario -->
          <div id="user-info" style="display: none;">
              <img src={userPhotoUrl} alt="Foto de Usuario" class="login-link"  id="modal-user-photo"/>
              <p id="user-name">{userName}</p>
              <button id="logout-button">Cerrar Sesión</button>
          </div>
          <!-- Formulario de inicio de sesión -->
          <div id="login-form" style="display: block;">
              <form id="login-form-element">
                  <label for="email">Correo:</label>
                  <input type="email" id="email" required />
                  <label for="password">Contraseña:</label>
                  <input type="password" id="password" required />
                  <button type="submit">Iniciar Sesión</button>
              </form>
              <button type="button" id="google-login-button" class="google-button">
                <img src="src/assets/google-logo.png" alt="Google Logo" style="height: 20px; vertical-align: middle; margin-right: 5px;" />
                Iniciar Sesión con Google
              </button>
          </div>
      </div>
  </div>
  <!-- Scripts -->
  <script>
import { loginUser,listenForAuthChanges, loginWithGoogle,logoutUser,isLoggedIn, userName,userPhotoUrl} from "./auth";
// Inicia la escucha de cambios de autenticación
    document.addEventListener('DOMContentLoaded', () => {
        const modal = document.getElementById('login-modal');
        const updateUserInfo = () => {
                listenForAuthChanges();
                const userInfo = document.getElementById('user-info');
                const loginForm = document.getElementById('login-form');
                const userPhoto = document.getElementById('user-photo')as HTMLImageElement;;
                const modalUserPhoto = document.getElementById('modal-user-photo')as HTMLImageElement;;
                if (isLoggedIn) {
                    document.getElementById('modal-title').textContent = 'Información del Usuario';
                    userInfo.style.display = 'block';
                    loginForm.style.display = 'none';
                    document.getElementById('user-name').textContent = userName; // Actualiza el nombre del usuario
                    userPhoto.src = userPhotoUrl; // Actualiza la foto del usuario en el header
                    modalUserPhoto.src = userPhotoUrl; 
                } else {
                    document.getElementById('modal-title').textContent = 'Iniciar Sesión';
                    userInfo.style.display = 'none';
                    loginForm.style.display = 'block';
                    userPhoto.src = 'src/assets/userDefault.jpg'; // Foto por defecto
                    modalUserPhoto.src = 'src/assets/userDefault.jpg';
                }
              };
      // Función para manejar el inicio de sesión con correo y contraseña
      const handleLogin = async (event) => {
          event.preventDefault();
          const email = document.getElementById('email').value;
          const password = document.getElementById('password').value;
          const success = await loginUser(email, password);
          if (success) {
              document.getElementById('login-modal').style.display = 'none'; // Cierra el modal
              updateUserInfo(); // Actualiza la información del usuario en el modal
          } else {
              alert('Error al iniciar sesión. Verifica tus credenciales.');
          }
      };
      // Función para manejar el inicio de sesión con Google
      const handleGoogleLogin = async () => {
          const success = await loginWithGoogle();
          if (success) {
              document.getElementById('login-modal').style.display = 'none'; // Cierra el modal
              updateUserInfo();
          } else {
              alert('Error al iniciar sesión con Google.');
          }
      };

      // Función para manejar el cierre de sesión
      const handleLogout = async () => {
        const success = await logoutUser();
            if (success) {
                modal.style.display = 'none'; // Cierra el modal
                updateUserInfo(); // Actualiza la información del usuario en el modal
            }
        }

          // Mostrar modal cuando se hace clic en la foto de usuario
      document.getElementById('user-photo').addEventListener('click', () => {
          modal.style.display = 'block'; // Mostrar el modal
          updateUserInfo(); // Actualiza la información del usuario en el modal
        });
        // Manejar cierre de sesión
        document.getElementById('logout-button').addEventListener('click', handleLogout);
         // Manejar el inicio de sesión con Google
          // Manejar el inicio de sesión con Google
          document.getElementById('google-login-button').addEventListener('click', async () => {
            await handleGoogleLogin(); // Llama a la función para manejar el inicio de sesión con Google
        });
         // Manejar el formulario de inicio de sesión
         document.getElementById('login-form-element').addEventListener('submit', handleLogin);
         // Actualizar la información del usuario al cargar la página
         updateUserInfo();
  });
  </script>
  <!-- Estilos para el header cuando se hace scroll -->
  <script>
    window.addEventListener('scroll', function() {
      const header = document.querySelector('.navbar');
      if (window.scrollY > 50) {
        header.classList.add('scrolled');
      } else {
        header.classList.remove('scrolled');
      }
    });
  </script>
</header>